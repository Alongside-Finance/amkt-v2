pragma solidity =0.8.18;

import {UpgradePreparationTest} from "test/upgrade/helpers/UpgradePreparation.t.sol";
import {console} from "forge-std/console.sol";

contract UpgradedTest is UpgradePreparationTest {
    bytes inputBatchExecutionData =
        hex"8d80ff0a0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000119b002260fac5e5542a773aa44fbcfedf7c193bc2c59900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000000000000016fac3b97007f39c581f595b53c5cb19bd0b3f8da6c935e2ca000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000011fd96f26ecec4892100418d75f65a02b3d53b2418fb8e1fe493759c760500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000019fa53d7c12e58dbfa00d31a59c85ae9d8edefec411d448f90841571b89c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000000000001345c63a49f007d1afa7b718fb893db30a3abc0cfc608aacfebb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac00000000000000000000000000000000000000000000063a306ec7db88dd9aba00514910771af9ca656af840dff83e8264ecf986ca00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac00000000000000000000000000000000000000000000005f5a7940a1691161ca0095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac00000000000000000000000000000000000000000603e50aeefd859097e44be20085f138bfee4ef8e540890cfb48f620571d67eda300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac00000000000000000000000000000000000000000000003cceb6eefa8ba6298b001f9840a85d5af5bf1d1762f925bdaddc4201f98400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000064b84cb0a631264df6009f8f72aa9304c8b593d555f12ef6589cc3a579a200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac0000000000000000000000000000000000000000000000002adb373eb5cf98fc005a98fcbea516cf06857215779fd812ca3bef1b3200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000098707a64551e254cbe00a0b73e1ff0b80914ab6fe0444e65848c4c34450b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac00000000000000000000000000000000000000000000000000000741ff72335a003c3a81e81dc49a522a592e7622a7e711c06bf35400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac00000000000000000000000000000000000000000000021465152d0d3961bfb4001df721d242e0783f8fcab4a9ffe4f35bdf32990900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000096c3e3ef7527c4a416004a220e6096b25eadb88358cb44068a324825467500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000002114c7fecf5657667000daf7e851f6054085432229150c1706988abc562000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000240c4c4285d646a9a5739aaab3db4e4e6534622bc4be3e691bbe7a92225081e91a6ffe9e6800f3bcedab2998933c6aad1cb31430d8bab329dd8c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000479ba509700e13ee59c41c67696754277cdc73710f6d65ef2ac000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004a4973a8e7d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000aeb9ef94b6542be7112f3a295646b5aaaa9fca130000000000000000000000000000000000000000000000000000000065497e00619185f2df60d53f08c7006b6de4717872467e3f2f886347d74d5d6b6377b4de000000000000000000000000000000000000000000000000000000000000000f0000000000000000000000002260fac5e5542a773aa44fbcfedf7c193bc2c59900000000000000000000000000000000000000000000000000000000000337780000000000000000000000007f39c581f595b53c5cb19bd0b3f8da6c935e2ca000000000000000000000000000000000000000000000000000284b1688681bd4000000000000000000000000418d75f65a02b3d53b2418fb8e1fe493759c7605000000000000000000000000000000000000000000000000003a2eaa2d426eb8000000000000000000000000d31a59c85ae9d8edefec411d448f90841571b89c0000000000000000000000000000000000000000000000000000000002b2a1e90000000000000000000000007d1afa7b718fb893db30a3abc0cfc608aacfebb00000000000000000000000000000000000000000000000000df27ce36ae22e7e000000000000000000000000514910771af9ca656af840dff83e8264ecf986ca00000000000000000000000000000000000000000000000000d58fddf58b699e00000000000000000000000095ad61b0a150d79219dcf64e1e6cc01f0b64c4ce000000000000000000000000000000000000000000000d78e294252c25fffffe00000000000000000000000085f138bfee4ef8e540890cfb48f620571d67eda300000000000000000000000000000000000000000000000000883099148f6bbe0000000000000000000000001f9840a85d5af5bf1d1762f925bdaddc4201f98400000000000000000000000000000000000000000000000000e194cf49bcc77e0000000000000000000000009f8f72aa9304c8b593d555f12ef6589cc3a579a200000000000000000000000000000000000000000000000000005ffc1c3e26c10000000000000000000000005a98fcbea516cf06857215779fd812ca3bef1b3200000000000000000000000000000000000000000000000001556ab0d08257ae000000000000000000000000a0b73e1ff0b80914ab6fe0444e65848c4c34450b000000000000000000000000000000000000000000000000000000001041564e0000000000000000000000003c3a81e81dc49a522a592e7622a7e711c06bf35400000000000000000000000000000000000000000000000004a8661afe7d6ebe0000000000000000000000001df721d242e0783f8fcab4a9ffe4f35bdf3299090000000000000000000000000000000000000000000000000151aac99ac01d4e0000000000000000000000004a220e6096b25eadb88358cb44068a32482546750000000000000000000000000000000000000000000000000004a176f750817a00998930c351ecb4918a5c5238b62d5277fe45ab9b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c49623609d000000000000000000000000f17a3fe536f8f7847f1385ec1bc967b2ca9cae8d000000000000000000000000e006fc6dc996ba5361cb880fef76f8aa9d5a7f7000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000024c4d66de8000000000000000000000000f3bcedab2998933c6aad1cb31430d8bab329dd8c0000000000000000000000000000000000000000000000000000000000f3bcedab2998933c6aad1cb31430d8bab329dd8c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024b1551b95000000000000000000000000000000000000000000000000000000001220b0b800f3bcedab2998933c6aad1cb31430d8bab329dd8c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024f2fde38b0000000000000000000000004c362fab50bc81f0f58ef2da6b6e10b55fc1d47800998930c351ecb4918a5c5238b62d5277fe45ab9b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024f2fde38b0000000000000000000000004c362fab50bc81f0f58ef2da6b6e10b55fc1d478000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
    bool triggerMigrationWarning_executeUpgradeBundle;
    string forkOverrideUrl = vm.envString("MAINNET_RPC");
    uint256 batchExecutionBlock;

    function setUp() public override {
        if (keccak256(abi.encodePacked(forkOverrideUrl)) == keccak256(abi.encodePacked("none"))) {
            super.setUp();
            executeUpgradeBundle();
        } else {
            vm.createSelectFork(forkOverrideUrl, 18470753);
            console.log(forkOverrideUrl);
            batchExecutionBlock = 18470753; // REPLACE WITH ACTUAL BLOCK
            super.setDeployedContracts();
        }
    }

    // WARN:
    // As a final check, the tests should be run with the actual calldata that signers will be using,
    // This serves as a redundant check that the calldata being signed is correct.
    function executeUpgradeBundle() public {
        batchExecutionBlock = block.number;
        triggerMigrationWarning_executeUpgradeBundle = false; // Flip when inputBatchExecution is used
        executeBatchData(batchExecutionData); // use inputBatchExecutionData instead, when it is ready
    }
}
